if (self.CavalryLogger) { CavalryLogger.start_js(["v7Zd5"]); }

__d("FileFormResetOnSubmit",["DOMQuery","Event","emptyFunction"],(function(a,b,c,d,e,f){__p&&__p();function g(a,c){a=b("Event").listen(a,"change",b("emptyFunction").thatReturnsFalse,b("Event").Priority.URGENT);try{c()}catch(a){throw a}finally{a.remove()}}function a(a){"use strict";this._form=a}a.prototype.enable=function(){"use strict";var a=this._reset.bind(this);this._subscription=this._form.subscribe("submit",function(){setTimeout(a,0)})};a.prototype.disable=function(){"use strict";this._subscription.unsubscribe(),this._subscription=null};a.prototype._reset=function(){"use strict";var a=this._form.getRoot();g(a,function(){var c=b("DOMQuery").scry(a,'input[type="file"]');c.forEach(function(a){a.value=""})})};e.exports=a}),null);
__d("submitForm",["DOM"],(function(a,b,c,d,e,f){"use strict";a=function(a){var c=a.querySelector('input[type="submit"]');c!=null?c.click():(c=b("DOM").create("input",{type:"submit",className:"hidden_elem"}),b("DOM").appendContent(a,c),c.click(),b("DOM").remove(c))};e.exports=a}),null);
__d("FormSubmitOnChange",["Event","submitForm"],(function(a,b,c,d,e,f){__p&&__p();function a(a){"use strict";this._form=a}a.prototype.enable=function(){"use strict";this._listener=b("Event").listen(this._form.getRoot(),"change",this._submit.bind(this))};a.prototype.disable=function(){"use strict";this._listener.remove(),this._listener=null};a.prototype._submit=function(){"use strict";b("submitForm")(this._form.getRoot())};Object.assign(a.prototype,{_listener:null});e.exports=a}),null);
__d("Emscripten",[],(function(a,b,c,d,e,f){e.exports={isSupported:function(){return typeof Int32Array!=="undefined"&&typeof Float64Array!=="undefined"&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set}}}),null);
__d("PUWErrorCodes",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({BAD_JPEG:9901,WORKER_TERMINATED:9902,UNKNOWN_RESIZE_ERROR:9903,WORKER_ABORT:9904})}),null);
__d("PooledWebWorker",["WebWorker"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("WebWorker"));g=c&&c.prototype;function a(a,b,c){"use strict";g.constructor.call(this,c),this.$PooledWebWorker1=b,this.$PooledWebWorker2=a}a.prototype.getIndex=function(){"use strict";return this.$PooledWebWorker1};a.prototype.getPool=function(){"use strict";return this.$PooledWebWorker2};e.exports=a}),null);
__d("WebWorkerPool",["PooledWebWorker","emptyFunction"],(function(a,b,c,d,e,f){__p&&__p();a.isSupported=function(){"use strict";return b("PooledWebWorker").isSupported()};function a(a,c){"use strict";this.$1=[];for(var d=0;d<c;d++)this.$1.push(new(b("PooledWebWorker"))(this,d,a).setErrorHandler(this.$2).setMessageHandler(this.$3).execute());this.$4=0}a.prototype.setMessageHandler=function(a){"use strict";this.$5=a||b("emptyFunction");return this};a.prototype.setAllowCrossPageTransition=function(a){"use strict";this.$1.forEach(function(b){return b.setAllowCrossPageTransition(a)});return this};a.prototype.setErrorHandler=function(a){"use strict";this.$6=a||b("emptyFunction");return this};a.prototype.postMessage=function(){"use strict";var a=this.getWorker();for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];a.postMessage.apply(a,c);return a};a.prototype.$3=function(){"use strict";for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];b.unshift(this);this.getPool().$5.apply(this.getPool(),b)};a.prototype.$2=function(){"use strict";for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];b.unshift(this);return this.getPool().$6.apply(this.getPool(),b)};a.prototype.getWorker=function(){"use strict";var a=this.$1[this.$4];this.$4=(this.$4+1)%this.$1.length;return a};e.exports=a}),null);
__d("JpegResizer",["Emscripten","JpegResizerConfig","JpegResizeWorkerResource","PUWErrorCodes","WebWorker","WebWorkerPool"],(function(a,b,c,d,e,f){__p&&__p();var g=null;h.isSupported=function(){"use strict";return b("WebWorkerPool").isSupported()&&b("Emscripten").isSupported()&&!b("JpegResizerConfig").isGKBlacklisted};h.getSingleton=function(a){"use strict";g||(g=new h(a||h.DEFAULT_POOL_SIZE).setAllowCrossPageTransition(!0));return g};h.prepareResource=function(a){"use strict";b("WebWorker").prepareResource(b("JpegResizeWorkerResource"),a)};function h(a){"use strict";a=a||h.DEFAULT_POOL_SIZE,b("WebWorker").prepareResource(b("JpegResizeWorkerResource")),this.$1=new(b("WebWorkerPool"))(b("JpegResizeWorkerResource"),a).setErrorHandler(this.$2.bind(this)).setMessageHandler(this.$3.bind(this)),this.$4={},this.$5=h.DEFAULT_RESIZE_HEIGHT,this.$6=h.DEFAULT_RESIZE_WIDTH,this.$7=0,this.$8=85}h.prototype.setHighQuality=function(a){"use strict";a?(this.$5=h.DEFAULT_RESIZE_HEIGHT,this.$6=h.DEFAULT_RESIZE_WIDTH):(this.$5=h.LOW_QUALITY_RESIZE_HEIGHT,this.$6=h.LOW_QUALITY_RESIZE_WIDTH);return this};h.prototype.setEncodeQuality=function(a){"use strict";this.$8=a;return this};h.prototype.setUndershoot=function(a){"use strict";this.$7=a;return this};h.prototype.setAllowCrossPageTransition=function(a){"use strict";this.$1.setAllowCrossPageTransition(a);return this};h.prototype.resizeBlob=function(a,b,c){"use strict";return this.$9(a,this.$6,this.$5,b,c)};h.prototype.resize360Blob=function(a,b,c,d){"use strict";var e=this.$6*3,f=this.$5*3;d&&(e=d,f=d);return this.$9(a,e,f,b,c)};h.prototype.$9=function(a,c,d,e,f){"use strict";__p&&__p();var g=this.$1.getWorker();if(g.isCurrentState("terminated")){var h=new Error("Worker terminated");h.code=b("PUWErrorCodes").WORKER_TERMINATED;e(h);return this}h=g.postMessage({blob:a,height:d,width:c,quality:this.$8,undershoot:this.$7}).getIndex();this.$10(h).unshift({done:e,progress:f});return this};h.prototype.$10=function(a){"use strict";Object.prototype.hasOwnProperty.call(this.$4,a)||(this.$4[a]=[]);return this.$4[a]};h.prototype.$2=function(a,b){"use strict";a.terminate();a=this.$10(a.getIndex());this.$11(b);a.forEach(function(a){return a.done(b)});a.length=0};h.prototype.$3=function(a,b){"use strict";b.error&&this.$11(b.error);if(b.done)this.$10(a.getIndex()).pop().done(b.error,b.blob,b.skipped,b.originalWidth,b.originalHeight);else{a=this.$10(a.getIndex());a=a[a.length-1].progress;a&&a({written:b.written,total:b.total})}};h.prototype.$11=function(a){"use strict";var c=a.message;c&&c.indexOf("Not a JPEG file")!==-1?a.code=b("PUWErrorCodes").BAD_JPEG:c&&c.indexOf("abort()")!==-1?a.code=b("PUWErrorCodes").WORKER_ABORT:a.code=b("PUWErrorCodes").UNKNOWN_RESIZE_ERROR};h.DEFAULT_POOL_SIZE=3;h.DEFAULT_RESIZE_HEIGHT=2048;h.DEFAULT_RESIZE_WIDTH=2048;h.LOW_QUALITY_RESIZE_HEIGHT=960;h.LOW_QUALITY_RESIZE_WIDTH=960;e.exports=h}),null);
__d("DataViewPolyfill",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function b(a,b,c){b===void 0?this.$1=new Uint8Array(a):c===void 0?this.$1=new Uint8Array(a,b):this.$1=new Uint8Array(a,b,c),this.byteLength=this.$1.byteLength}b.prototype.getUint8=function(a){if(a>=this.$1.length)throw new Error("Trying to read beyond bounds of DataViewPolyfill");return this.$1[a]};b.prototype.getUint16=function(a,b){var c=this.getUint8(a);a=this.getUint8(a+1);return b?a*256+c:c*256+a};b.prototype.getUint32=function(a,b){var c=this.getUint8(a),d=this.getUint8(a+1),e=this.getUint8(a+2);a=this.getUint8(a+3);return b?((a*256+e)*256+d)*256+c:((c*256+d)*256+e)*256+a};b.isSupported=function(){return!!a.Uint8Array};e.exports=b}),null);
__d("getImageSize",["DataViewPolyfill"],(function(a,b,c,d,e,f){__p&&__p();var g=a.DataView||b("DataViewPolyfill");function h(a){return{width:a.getUint16(6,!0),height:a.getUint16(8,!0)}}function i(a){return{width:a.getUint32(16,!1),height:a.getUint32(20,!1)}}function j(a){var b=a.byteLength,c=2;while(c<b){var d=a.getUint16(c,!1);c+=2;if(d==65472||d==65474)return{width:a.getUint16(c+5,!1),height:a.getUint16(c+3,!1)};else c+=a.getUint16(c,!1)}return null}function c(a){a=new g(a);if(a.getUint8(0)==255&&a.getUint8(1)==216)return j(a);if(a.getUint8(0)==71&&a.getUint8(1)==73&&a.getUint8(2)==70)return h(a);return a.getUint8(0)==137&&a.getUint8(1)==80&&a.getUint8(2)==78&&a.getUint8(3)==71?i(a):null}e.exports=c;c.gif=h;c.png=i;c.jpeg=j}),null);
__d("ChatAutoSendPhotoUploader",["csx","fbt","invariant","ArbiterMixin","AsyncRequest","AsyncUploadRequest","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","JpegResizer","MercuryAttachmentType","MercuryConstants","PhotosMimeType","PhotosUploadID","Run","SubscriptionsHandler","URI","getImageSize","getObjectValues","isEmpty","mixin"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j;function k(){return"upload_"+b("PhotosUploadID").getNewID()}function l(a){return Array.prototype.reduce.call(a,function(a,b){var c=k();a[c]=b;return a},{})}c=babelHelpers.inherits(a,b("mixin")(b("ArbiterMixin")));j=c&&c.prototype;function a(a,c,d,e){__p&&__p();j.constructor.call(this);this.$ChatAutoSendPhotoUploader1=d;this.$ChatAutoSendPhotoUploader2=c;this.$ChatAutoSendPhotoUploader3=e;this.$ChatAutoSendPhotoUploader4=new(b("SubscriptionsHandler"))();this.$ChatAutoSendPhotoUploader5={};this.$ChatAutoSendPhotoUploader6={};this.$ChatAutoSendPhotoUploader7=!1;this.$ChatAutoSendPhotoUploader8=a.getAttribute("action");this.$ChatAutoSendPhotoUploader9=new(b("FileForm"))(a,[b("FormSubmitOnChange"),b("FileFormResetOnSubmit")]);this.$ChatAutoSendPhotoUploader9.setAllowCrossOrigin(!0);this.$ChatAutoSendPhotoUploader9.setUploadInParallel(!0);e&&this.$ChatAutoSendPhotoUploader9.setCustomHttpHeader("X-MSGR-Region",e);d=b("DOM").find(a,"._4q60");e=b("DOM").find(d,"._4q61");this.$ChatAutoSendPhotoUploader10=new(b("FileInput"))(d,e,c);this.$ChatAutoSendPhotoUploader4.addSubscriptions(b("Run").onBeforeUnload(this.onBeforeUnload.bind(this)),this.$ChatAutoSendPhotoUploader9.subscribe("success",this.$ChatAutoSendPhotoUploader11.bind(this)),this.$ChatAutoSendPhotoUploader9.subscribe("failure",this.$ChatAutoSendPhotoUploader12.bind(this)),this.$ChatAutoSendPhotoUploader9.subscribe("progress",this.$ChatAutoSendPhotoUploader13.bind(this)),b("Event").listen(e,"click",function(){this.$ChatAutoSendPhotoUploader14===void 0&&this.$ChatAutoSendPhotoUploader15(),this.$ChatAutoSendPhotoUploader14&&b("JpegResizer").prepareResource(),this.inform("open")}.bind(this)))}a.prototype.$ChatAutoSendPhotoUploader15=function(){this.$ChatAutoSendPhotoUploader14=b("JpegResizer").isSupported(),this.$ChatAutoSendPhotoUploader14&&this.$ChatAutoSendPhotoUploader9.setPreprocessHandler(this.$ChatAutoSendPhotoUploader16.bind(this))};a.prototype.onBeforeUnload=function(){if(this.isUploading()&&!this.$ChatAutoSendPhotoUploader7)return h._("You haven't sent your message yet. Do you want to leave without sending?")};a.prototype.isUploading=function(){return!b("isEmpty")(this.$ChatAutoSendPhotoUploader5)};a.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader4.release(),this.$ChatAutoSendPhotoUploader9.destroy(),this.$ChatAutoSendPhotoUploader5={},this.$ChatAutoSendPhotoUploader6={}};a.prototype.$ChatAutoSendPhotoUploader17=function(a,b){a=this.$ChatAutoSendPhotoUploader18(a);b&&(a.preview_width=b.width,a.preview_height=b.height);return a};a.prototype.$ChatAutoSendPhotoUploader18=function(a){a={upload_id:a,on_progress:function(a){this.$ChatAutoSendPhotoUploader4.addSubscriptions(this.subscribe("progress",a))}.bind(this),on_resizing_progress:function(a){this.$ChatAutoSendPhotoUploader4.addSubscriptions(this.subscribe("resize_progress",a))}.bind(this),on_success:function(a){this.$ChatAutoSendPhotoUploader4.addSubscriptions(this.subscribe("success",a))}.bind(this),upload_canceled:this.$ChatAutoSendPhotoUploader19.bind(this),attach_type:b("MercuryAttachmentType").PHOTO,preview_uploading:!0};return a};a.prototype.$ChatAutoSendPhotoUploader16=function(a,c){var d=a.getFile();if(!b("PhotosMimeType").isJpeg(d.type)){c(a);return}b("JpegResizer").getSingleton().resizeBlob(d,function(b,d,e,f,g){d&&a.setFile(d),c(a)},this.$ChatAutoSendPhotoUploader20.bind(this,a))};a.prototype.$ChatAutoSendPhotoUploader21=function(a){__p&&__p();if(!a)return!1;var c=0;for(var d=0;d<a.length;d++){var e=a[d];c+=e.size;if(c>b("MercuryConstants").AttachmentMaxSize){this.inform("file-upload-error",{error:"size-exceeded"});return!1}if(e.type==="application/x-msdownload"||e.type==="application/x-msdownload-x64"){this.inform("file-upload-error",{error:"wrong-type"});return!1}}return!0};a.prototype.$ChatAutoSendPhotoUploader22=function(a,c,d){__p&&__p();d===void 0&&(d={});if(FileReader!==void 0&&FileReader.prototype.readAsArrayBuffer&&c&&c.length===1){this.$ChatAutoSendPhotoUploader5[a]=a;d[a]=c[0];var e=new FileReader();e.onload=function(){this.inform("submit",{upload_id:a,preview_attachments:[this.$ChatAutoSendPhotoUploader17(a,b("getImageSize")(e.result))]})}.bind(this);e.onerror=function(){this.inform("submit",{upload_id:a,preview_attachments:[this.$ChatAutoSendPhotoUploader18(a)]})}.bind(this);if(c[0].size)e.readAsArrayBuffer(c[0]);else{var f=babelHelpers["extends"]({},this.$ChatAutoSendPhotoUploader17(a,c[0].source),{preview_url:c[0].preview_url});this.inform("submit",{upload_id:a,preview_attachments:[f]})}}else{var g=[];if(!c)this.$ChatAutoSendPhotoUploader5[a]=a,this.$ChatAutoSendPhotoUploader1.value=a,g.push(this.$ChatAutoSendPhotoUploader18(a));else{f=Object.keys(d);if(f.length>0)f.forEach(function(b){this.$ChatAutoSendPhotoUploader5[b]=a,g.push(this.$ChatAutoSendPhotoUploader18(b))}.bind(this));else for(var f=0;f<c.length;++f){var h=k();d[h]=c[f];this.$ChatAutoSendPhotoUploader5[h]=a;g.push(this.$ChatAutoSendPhotoUploader18(h))}}this.inform("submit",{upload_id:a,preview_attachments:g})}Object.keys(d).length>0&&this.$ChatAutoSendPhotoUploader9.setFiles(d)};a.prototype.$ChatAutoSendPhotoUploader11=function(event,a){__p&&__p();var b=this.$ChatAutoSendPhotoUploader23(a);if(this.$ChatAutoSendPhotoUploader5[b]){var c=this.$ChatAutoSendPhotoUploader5[b];delete this.$ChatAutoSendPhotoUploader5[b];a=a.response.getPayload();this.$ChatAutoSendPhotoUploader6[c]||(this.$ChatAutoSendPhotoUploader6[c]=[]);this.$ChatAutoSendPhotoUploader6[c].push({id:b,audio_id:a.metadata[0].audio_id,image_id:a.metadata[0].image_id,file_id:a.metadata[0].file_id,gif_id:a.metadata[0].gif_id,video_id:a.metadata[0].video_id});this.inform("success",{upload_id:b});this.$ChatAutoSendPhotoUploader24(c)||this.$ChatAutoSendPhotoUploader25(c);this.$ChatAutoSendPhotoUploader10.clear();this.$ChatAutoSendPhotoUploader2=this.$ChatAutoSendPhotoUploader10.getInput()}};a.prototype.$ChatAutoSendPhotoUploader25=function(a){this.$ChatAutoSendPhotoUploader24(a)&&i(0,6185),this.$ChatAutoSendPhotoUploader6[a].sort(function(a,b){return a.id<b.id?-1:1}),this.inform("all-uploads-completed",{upload_id:a,audio_ids:this.$ChatAutoSendPhotoUploader6[a].map(function(a){return a.audio_id}),image_ids:this.$ChatAutoSendPhotoUploader6[a].map(function(a){return a.image_id}),file_ids:this.$ChatAutoSendPhotoUploader6[a].map(function(a){return a.file_id}),gif_ids:this.$ChatAutoSendPhotoUploader6[a].map(function(a){return a.gif_id}),video_ids:this.$ChatAutoSendPhotoUploader6[a].map(function(a){return a.video_id})}),delete this.$ChatAutoSendPhotoUploader6[a]};a.prototype.$ChatAutoSendPhotoUploader13=function(event,a){this.inform("progress",{upload_id:a.upload.getName(),event:a.event})};a.prototype.$ChatAutoSendPhotoUploader20=function(a,event){this.inform("resize_progress",{upload_id:a.getName(),event:event})};a.prototype.$ChatAutoSendPhotoUploader24=function(a){return b("getObjectValues")(this.$ChatAutoSendPhotoUploader5).includes(a)};a.prototype.$ChatAutoSendPhotoUploader12=function(event,a){var b=this.$ChatAutoSendPhotoUploader23(a);this.$ChatAutoSendPhotoUploader26(b,"last-upload-failed",a.additionalParams);this.$ChatAutoSendPhotoUploader10.clear();this.$ChatAutoSendPhotoUploader2=this.$ChatAutoSendPhotoUploader10.getInput();return!1};a.prototype.$ChatAutoSendPhotoUploader19=function(a){this.$ChatAutoSendPhotoUploader26(a,"last-upload-canceled")};a.prototype.$ChatAutoSendPhotoUploader26=function(a,b,c){if(!this.$ChatAutoSendPhotoUploader5[a])return;var d=this.$ChatAutoSendPhotoUploader5[a];delete this.$ChatAutoSendPhotoUploader5[a];this.$ChatAutoSendPhotoUploader24(d)||(this.$ChatAutoSendPhotoUploader6[d]?this.$ChatAutoSendPhotoUploader25(d):this.inform(b,babelHelpers["extends"]({upload_id:d},c)))};a.prototype.$ChatAutoSendPhotoUploader23=function(a){if(a.upload)return a.upload.getName();else return a.response&&a.response.getPayload().uploadID||a.getName()};a.prototype.uploadFiles=function(a){__p&&__p();if(!this.$ChatAutoSendPhotoUploader21(a))return;var c=k();if(a.length===1){var d;d=(d={},d[c]=a[0],d)}else d=l(a);var e=new(b("AsyncUploadRequest"))(this.$ChatAutoSendPhotoUploader8).setAllowCrossOrigin(!0).setAllowCrossPageTransition(this.$ChatAutoSendPhotoUploader7).setRelativeTo(this.$ChatAutoSendPhotoUploader9.getRoot()).setFiles(d);this.$ChatAutoSendPhotoUploader3&&e.setCustomHttpHeader("X-MSGR-Region",this.$ChatAutoSendPhotoUploader3);this.$ChatAutoSendPhotoUploader4.addSubscriptions(e.subscribe("success",function(event,a){this.$ChatAutoSendPhotoUploader11(event,{upload:a,response:a.getResponse()})}.bind(this)),e.subscribe("failure",this.$ChatAutoSendPhotoUploader12.bind(this)));e.send();this.$ChatAutoSendPhotoUploader22(c,a,d)};a.prototype.uploadURL=function(a){var c=k(),d=a.errorDialogParams;delete a.errorDialogParams;var e=new(b("AsyncRequest"))().setURI(new(b("URI"))(this.$ChatAutoSendPhotoUploader8).getPath()).setAllowCrossPageTransition(this.$ChatAutoSendPhotoUploader7).setData(babelHelpers["extends"]({},a,{attach_id:c})).setErrorHandler(function(a){this.$ChatAutoSendPhotoUploader12(null,{additionalParams:{errorDialogParams:d},response:{getPayload:function(){return{uploadID:c}}}})}.bind(this)).setHandler(function(a){this.$ChatAutoSendPhotoUploader11(null,{response:a})}.bind(this));e.send();this.$ChatAutoSendPhotoUploader22(c,[a])};a.prototype.setAllowCrossPage=function(a){this.$ChatAutoSendPhotoUploader7=a,this.$ChatAutoSendPhotoUploader9.setAllowCrossPageTransition(a)};e.exports=a}),null);